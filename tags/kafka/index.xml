<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Kafka on éª†çµä¸Šçš„ä¸ªäººç½‘ç«™</title><link>https://farsightli.github.io/tags/kafka/</link><description>Recent content in Kafka on éª†çµä¸Šçš„ä¸ªäººç½‘ç«™</description><generator>Hugo -- gohugo.io</generator><language>en</language><copyright>éª†çµä¸Š</copyright><lastBuildDate>Thu, 05 Jun 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://farsightli.github.io/tags/kafka/index.xml" rel="self" type="application/rss+xml"/><item><title>kafkaåŸºç¡€æ¶æ„ç†è®º</title><link>https://farsightli.github.io/p/kafka%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E7%90%86%E8%AE%BA/</link><pubDate>Thu, 05 Jun 2025 00:00:00 +0000</pubDate><guid>https://farsightli.github.io/p/kafka%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E7%90%86%E8%AE%BA/</guid><description>&lt;h2 id="kafkaè¦è§£å†³çš„é—®é¢˜">Kafkaè¦è§£å†³çš„é—®é¢˜ï¼š
&lt;/h2>&lt;p>åŸè§†é¢‘ï¼š&lt;/p>
&lt;p>ã€æ¶ˆæ¯é˜Ÿåˆ—Kafkaæ˜¯ä»€ä¹ˆï¼Ÿæ¶æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ5åˆ†é’Ÿå¿«é€Ÿå…¥é—¨ã€‘https://www.bilibili.com/video/BV1TT421y79S?vd_source=f2fbf19a95f21a30c8f56673d2b182b7&lt;/p>
&lt;p>æ¶ˆè´¹è€…ä¸ç”Ÿäº§è€…ä¹‹é—´çš„ç”Ÿäº§é€Ÿåº¦å’Œæ¶ˆè´¹é€Ÿåº¦æ˜¯ä¸åŒ¹é…çš„ã€‚å¦‚æœç”Ÿäº§çš„æ¶ˆæ¯éƒ½å¾€æ¶ˆè´¹è€…å¡ï¼Œé‚£ä¹ˆæ¶ˆè´¹è€…å¾ˆå®¹æ˜“æŒ‚æ‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æŠŠæ¶ˆæ¯å‘å¾€ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ã€‚æ¶ˆæ¯é˜Ÿåˆ—å¯ä»¥èµ·åˆ° 1å‰Šå³°å¡«è°· 2.è§£è€¦ 3.å¼‚æ­¥ ç­‰ä½œç”¨ã€‚ä½†å¦‚æœæ¶ˆæ¯é˜Ÿåˆ—ä¸æ¶ˆè´¹è€…è€¦åˆï¼Œä¼šæœ‰å¾ˆå¤šé—®é¢˜ã€‚äºæ˜¯éœ€è¦æŠŠæ¶ˆæ¯é˜Ÿåˆ—æŠ½è±¡å‡ºæ¥ï¼Œè€ŒKafkaå°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸€ç§ä¸­é—´ä»¶ã€‚&lt;/p>
&lt;p>éšç€æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…çš„å¢åŠ ï¼Œæ¶ˆæ¯çš„ååå¢åŠ äº†ã€‚ç„¶è€Œååé‡åˆ°è¾¾ä¸€å®šç¨‹åº¦ï¼Œé‚£ä¹ˆå¤šä¸ªæ¶ˆè´¹è€…/ç”Ÿäº§è€…å°±ä¼šå…±åŒäº‰æŠ¢ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ï¼Œä¼šæœ‰ç­‰å¾…æ—¶é—´ã€‚è¿™æ ·å°±å‡ºç°äº†æ€§èƒ½é—®é¢˜ã€‚é‚£ä¹ˆè¿™æ—¶å€™å°±å¯ä»¥å¢åŠ æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒæŒ‡å®šä¸åŒç§ç±»çš„æ¶ˆè´¹è€…å’Œç”Ÿäº§è€…ä½¿ç”¨æŸä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—&amp;ndash;è¿™ä¸ªå°±æ˜¯topicã€‚å•ä¸ªtopicæ•°æ®é‡è¿‡å¤§æ—¶ï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†å•ä¸ªtopicæ‹†å¼€ï¼Œè¿™å°±æ˜¯partitionï¼Œç„¶åæ¯ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸åŒpartitionã€‚&lt;/p>
&lt;p>å¦‚æœå¤šä¸ªpartitionéƒ½æ”¾åœ¨åŒä¸€å°æœºå™¨ä¸Šï¼Œåˆ™ä¼šå¯¹æœºå™¨é€ æˆæ€§èƒ½å‹åŠ›ï¼Œé‚£ä¹ˆå¯ä»¥å°†ä¸åŒpartitionæ”¾åœ¨ä¸åŒæœºå™¨ä¸Šï¼Œé‚£ä¹ˆæ¯ä¸ªæœºå™¨å°±æ˜¯ä¸€ä¸ªborkerã€‚&lt;/p>
&lt;p>å¦‚æœbrokerçš„æœºå™¨æŒ‚æ‰äº†ï¼Œé‚£ä¹ˆæ•°æ®å°±å…¨ä¸¢äº†ã€‚ä¸ºäº†åšåˆ°é«˜å¯ç”¨æ€§ï¼Œå¾€å¾€å°†partitionåšå¤‡ä»½å³å‰¯æœ¬replicasã€‚&lt;/p>
&lt;p>leaderè´Ÿè´£è¯»å†™ã€followerè´Ÿè´£åŒæ­¥leaderã€‚ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œå¾€å¾€è¿˜ä¼šå¯¹æ•°æ®è¿›è¡ŒæŒä¹…åŒ–ã€‚å°†æ•°æ®å†™åˆ°ç£ç›˜ä¸Šï¼Œç„¶åæ ¹æ®æŸç§ç­–ç•¥æ¸…ç†ç£ç›˜&lt;/p>
&lt;h3 id="æ¶ˆè´¹ç»„-consumer-groupç›¸å…³æ¦‚å¿µ">æ¶ˆè´¹ç»„ consumer groupç›¸å…³æ¦‚å¿µ
&lt;/h3>&lt;p>æ¶ˆè´¹ç»„æ˜¯ä¸ºäº†è§£å†³ï¼šå•ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹é€Ÿåº¦è·Ÿä¸ä¸Šç”Ÿäº§è€…ï¼Œé‚£ä¹ˆå°±å¢åŠ å¤šä¸ªæ¶ˆè´¹è€…ç»„æˆæ¶ˆè´¹ç»„æ¥å…±åŒæ¶ˆè´¹æŸä¸ªtopicã€‚&lt;/p>
&lt;p>kafkaæ§åˆ¶äº†åœ¨ä¸€ä¸ªæ¶ˆè´¹ç»„ä¸­ï¼Œï¼ŒåŒä¸€ Partition å†…çš„æ¶ˆæ¯åœ¨åŒä¸€ä¸ª Consumer Group ä¸­åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…å®ä¾‹å¤„ç†ã€‚è€Œä¸åŒæ¶ˆè´¹ç»„ä¹‹é—´æ˜¯å¯ä»¥ç‹¬ç«‹çš„æ¶ˆè´¹åŒä¸€æ¡æ¶ˆæ¯ã€‚&lt;/p>
&lt;p>æ¶ˆè´¹ç»„è®¢é˜…çš„æ˜¯topicï¼Œè®¢é˜…åï¼Œè°ƒåº¦è€…coordinateå°±ä¼šå°†ä¸åŒpartitionåˆ†é…ç»™ä¸åŒæ¶ˆè´¹è€…å®ä¾‹ã€‚è°ƒåº¦å‘˜coordinateä¼šåœ¨æ¶ˆè´¹è€…å¢å‡ã€partitionå¢å‡ã€æ¶ˆè´¹ç»„è®¢é˜…æ–°topicæ—¶è¿›è¡Œé‡æ–°åˆ†é…rebalanceã€‚rebalanceæ—¶groupä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…ä¼šæš‚åœæ¶ˆè´¹è‡³é‡æ–°åˆ†é…å®Œæ¯•&lt;/p>
&lt;h3 id="ç”Ÿäº§è€…çš„æ ¸å¿ƒæœºåˆ¶">ç”Ÿäº§è€…çš„æ ¸å¿ƒæœºåˆ¶
&lt;/h3>&lt;p>æ¶ˆæ¯åˆ†å‘ç­–ç•¥ï¼šç”Ÿäº§è€…è¦æŒ‡å®štopicï¼Œé‚£ä¹ˆè¿›å…¥topicçš„æ¶ˆæ¯åº”è¯¥å»å“ªä¸ªpartitionï¼Ÿè¿™æœ‰ä¸åŒç­–ç•¥ï¼Œæ¯”å¦‚è½®è¯¢åˆ†é…ï¼Œæ¯”å¦‚æŒ‰æŸä¸ªè§„åˆ™hashåˆ†é…ã€‚&lt;/p>
&lt;p>ACKæœºåˆ¶ï¼šå¯ä»¥ä¸ç¡®è®¤ï¼ˆacks=0ï¼‰ã€leaderç¡®è®¤ï¼ˆacks=1ï¼‰ã€leaderåŠfollowerç¡®è®¤ï¼ˆacks=allï¼‰&lt;/p>
&lt;p>acks=allæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªå‚æ•°min.insync.replicaså³isrçš„å‰¯æœ¬å¤§äºç­‰äºè¿™ä¸ªå‚æ•°æ—¶ï¼Œå°±å¯ä»¥å‘ç”Ÿäº§è€…è¿”å›ack&lt;/p>
&lt;p>å‘é€æ—¶ï¼Œæ¶ˆæ¯å…ˆæ”¾åˆ°å‘é€ç¼“å†²åŒºä¸­ï¼Œç„¶åå†æ”’æ‰¹èšåˆå‘é€&lt;/p>
&lt;h3 id="é«˜æ°´ä½çº¿--high-watermarkæœºåˆ¶">é«˜æ°´ä½çº¿ high watermarkæœºåˆ¶
&lt;/h3>&lt;p>hwæ ‡è®°äº†ä¸€ä¸ªä½ç½®&amp;ndash;æ‰€æœ‰å‰¯æœ¬éƒ½å·²ç»åŒæ­¥çš„æ¶ˆæ¯offsetä½ç½®ï¼Œæ¶ˆè´¹è€…åªèƒ½è¯»å–åˆ°å°äºhwçš„æ¶ˆæ¯&lt;/p>
&lt;p>AIç”»çš„å›¾ï¼š&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Offset&lt;/th>
&lt;th>0&lt;/th>
&lt;th>1&lt;/th>
&lt;th>2&lt;/th>
&lt;th>3&lt;/th>
&lt;th>4&lt;/th>
&lt;th>5&lt;/th>
&lt;th>6&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>æ¶ˆæ¯&lt;/td>
&lt;td>A&lt;/td>
&lt;td>B&lt;/td>
&lt;td>C&lt;/td>
&lt;td>D&lt;/td>
&lt;td>E&lt;/td>
&lt;td>F&lt;/td>
&lt;td>G&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>çŠ¶æ€&lt;/td>
&lt;td>âœ…&lt;/td>
&lt;td>âœ…&lt;/td>
&lt;td>âœ…&lt;/td>
&lt;td>âœ…&lt;/td>
&lt;td>ğŸš«&lt;/td>
&lt;td>ğŸš«&lt;/td>
&lt;td>ğŸš«&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl"> â†‘
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> HW=4 (å®‰å…¨æ°´ä½çº¿)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ­¤æ—¶å½“æ‰€æœ‰followerç¡®è®¤æ¶ˆæ¯EæŒä¹…åŒ–åï¼ŒHWå°±ä¼šæ›´æ–°ä¸º5&lt;/p>
&lt;p>HWåªç”±Leaderè¿›è¡Œæ›´æ–°ç»´æŠ¤ï¼Œä¼šç”±kafkaçš„å„ç§å¼ºåˆ¶åˆ·ç›˜æœºåˆ¶å†™åˆ°ç£ç›˜ä¸Š&lt;/p>
&lt;p>ç–‘é—®ï¼š&lt;/p>
&lt;p>1.ä¸ºä»€ä¹ˆæœ‰topicå’Œpartitionçš„æ¦‚å¿µï¼Œç›´æ¥æ–°å¢æ¶ˆæ¯é˜Ÿåˆ—ä¸å°±è¡Œäº†ï¼Ÿ&lt;/p>
&lt;p>topicæ˜¯æŒ‡Kafkaå°†ä¸€äº›ç”Ÿäº§ã€æ¶ˆè´¹çš„æ•°æ®æŠ½è±¡å‡ºæ¥ï¼Œæ–¹ä¾¿ä¸åŒåŠŸèƒ½çš„ç”Ÿäº§è€…æ¶ˆè´¹è€…æ“ä½œæ¶ˆæ¯ã€‚ä¹Ÿå°±æ˜¯èµ·åˆ°åˆ†ç±»åŠŸèƒ½ã€‚è¿˜å¯ä»¥ä½¿ç”Ÿäº§è€…æ¶ˆè´¹è€…åªå…³å¿ƒå¦‚ä½•æ”¶å‘æ•°æ®ï¼Œç”Ÿäº§è€…ä¸å¿…é¢å¤–è®¾è®¡æ ‡è¯†ä½¿æ¶ˆè´¹è€…æ­£ç¡®æ¶ˆè´¹ã€‚è¿™æ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„åˆ†åŒºã€‚&lt;/p>
&lt;p>è€Œpartitionå°†topicåˆ†å¼€ï¼Œè¿™ç§åˆ†åŒºæ˜¯ä¸€ç§ç‰©ç†ä¸Šçš„åˆ†åŒºã€‚ä¸åŒpartitionåˆ†å¸ƒåœ¨ä¸åŒbrokeræˆ–ç£ç›˜ä¸Šï¼Œä½¿å‡å°‘è¯»å†™ioçš„å†²çªã€‚æ­¤å¤–ï¼Œpartitionè¿˜æä¾›äº†å¹¶å‘æ¶ˆè´¹çš„èƒ½åŠ›ã€‚&lt;/p>
&lt;p>2.å‡å¦‚å‰¯æœ¬flowerå°šæœªæ‹‰å–åŒæ­¥å®Œleaderçš„æ¶ˆæ¯ï¼ŒleadæŒ‚æ‰äº†ï¼Œæ­¤æ—¶é€‰ä¸¾å‡ºæ¥çš„leaderå²‚ä¸æ˜¯ä¼šä¸¢æ¶ˆæ¯ï¼Ÿ&lt;/p>
&lt;p>è¿™æ˜¯AIç»™çš„åœºæ™¯å¤ç°ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åˆå§‹çŠ¶æ€&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Topic åˆ†åŒºÂ P0Â æœ‰ 3 ä¸ªå‰¯æœ¬ï¼šLeader L1ï¼ŒFollower F2ï¼ŒFollower F3ï¼ˆISR = [L1, F2, F3]ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”Ÿäº§è€…å‘é€æ¶ˆæ¯Â M1Â åˆ°Â L1ï¼ŒL1Â å°†Â M1Â å†™å…¥æœ¬åœ°æ—¥å¿—ï¼ˆä½†å°šæœªåŒæ­¥ç»™ Followerï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;code>æ•…éšœå‘ç”Ÿ&lt;/code>&lt;/p>
&lt;ul>
&lt;li>
&lt;p>L1Â çªç„¶å®•æœºï¼ˆæ­¤æ—¶Â M1Â æœªåŒæ­¥ç»™ä»»ä½• Followerï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç³»ç»Ÿéœ€é€‰ä¸¾æ–° Leaderï¼ˆF2Â æˆ–Â F3ï¼‰&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>é£é™©
è‹¥é€‰å‡ºçš„æ–° Leader æ˜¯Â F2Â æˆ–Â F3ï¼Œå®ƒä»¬ä»æœªæ”¶åˆ°è¿‡Â M1ï¼Œå¯¼è‡´Â M1Â æ°¸ä¹…ä¸¢å¤±ï¼&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>è§£å†³æ–¹æ¡ˆï¼š1ã€ACKç­–ç•¥æŒ‡å®šall åˆ™åªè¦ç”Ÿäº§è€…ç¡®è®¤æˆåŠŸï¼Œé‚£æ‰€æœ‰ISRéƒ½æœ‰æ•°æ®ï¼Œä¸ä¼šä¸¢å¤±&lt;/p>
&lt;ol start="2">
&lt;li>
&lt;p>å‡å¦‚acks=1ï¼Œé‚£ä¹ˆåœ¨æ­¤åœºæ™¯ä¸­ï¼Œ&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Leader (L) å·²å†™å…¥æ¶ˆæ¯ E (Offset=4)&lt;/p>
&lt;/li>
&lt;li>
&lt;p>F1 åŒæ­¥äº† E â†’ ISR = [L, F1, F2]&lt;/p>
&lt;/li>
&lt;li>
&lt;p>F2Â æœªåŒæ­¥ Eï¼ˆå› ç½‘ç»œå»¶è¿Ÿï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ­¤æ—¶ HW ä»ä¸º 4ï¼ˆå›  F2 æœªç¡®è®¤ï¼Œæ¶ˆæ¯ E ä¸ç®—å®‰å…¨ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çªå‘æ•…éšœï¼šLeader (L) å®•æœºï¼&lt;/p>
&lt;p>F1è¢«é€‰ä¸¾ä¸ºLeaderï¼Œä¼šè¿›è¡Œæ£€æŸ¥ï¼Œå‘ç°HW=4ï¼Œåˆ™å°†æ¶ˆæ¯Eä¸¢å¼ƒã€‚è€ŒF2æ£€æŸ¥åä¸åšå¤„ç†ï¼ˆå› ä¸ºç¬¦åˆHWï¼‰ã€‚ç„¶åå°±æ˜¯æ­£å¸¸çš„åŒæ­¥æ•°æ®æµç¨‹&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="æ¶ˆè´¹è€…çš„æ ¸å¿ƒæœºåˆ¶">æ¶ˆè´¹è€…çš„æ ¸å¿ƒæœºåˆ¶
&lt;/h3>&lt;p>TODO&lt;/p>
&lt;h3 id="ä»ä»£ç çœ‹ä¸åŒackså¤„ç†">ä»ä»£ç çœ‹ä¸åŒackså¤„ç†
&lt;/h3>&lt;p>ä»¥ä¸‹ä»£ç ç”±AIæä¾›ï¼Œæš‚æœªéªŒè¯æ˜¯å¦å‡†ç¡®&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-java" data-lang="java">&lt;span class="line">&lt;span class="cl">&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// CASE 1: acks=0 (æœ€é«˜åå)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;acks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// æ— éœ€ç¡®è®¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">producer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;topic&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">));&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ç‰¹ç‚¹ï¼šå‘é€å³å¿˜ï¼Œä¸å¤„ç†å“åº”ï¼ˆå¯èƒ½ä¸¢å¤±ï¼‰&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// CASE 2: acks=1 (å¹³è¡¡æ¨¡å¼)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;acks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;1&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// Leader ç¡®è®¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">producer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;topic&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metadata&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å‘é€å¤±è´¥&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// å¤„ç†å¤±è´¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">else&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">debug&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;å‘é€æˆåŠŸ: {}&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">metadata&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">offset&lt;/span>&lt;span class="p">());&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ç‰¹ç‚¹ï¼šå¤„ç†Leaderå“åº”ï¼Œç½‘ç»œå¼‚å¸¸å¯èƒ½é‡å¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// CASE 3: acks=all (é«˜å¯é )&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// --------------------------&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;acks&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;all&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">props&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">put&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;min.insync.replicas&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;2&amp;#34;&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è¦æ±‚è‡³å°‘2ä¸ªå‰¯æœ¬åŒæ­¥&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="n">producer&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="na">send&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">new&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">ProducerRecord&lt;/span>&lt;span class="o">&amp;lt;&amp;gt;&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;topic&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s">&amp;#34;value&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">metadata&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">-&amp;gt;&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="o">!=&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">null&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="k">if&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="k">instanceof&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="n">NotEnoughReplicasException&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c1">// ISRå‰¯æœ¬ä¸è¶³æ—¶çš„ç‰¹æ®Šå¤„ç†&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="n">retryOrFail&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">e&lt;/span>&lt;span class="p">);&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c1">// è‡ªå®šä¹‰é‡è¯•é€»è¾‘&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="p">}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="p">});&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c1">// ç‰¹ç‚¹ï¼šä¸¥æ ¼ä¸€è‡´æ€§ä¿éšœï¼Œéœ€å¤„ç†å‰¯æœ¬åŒæ­¥å¼‚å¸¸&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨acks=0çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡æœ‰å›è°ƒæ–¹æ³•çš„ï¼Œæ‰€ä»¥ä¹Ÿå°±æ‹¿ä¸åˆ°å…ƒæ•°æ®å’Œå¼‚å¸¸ä¿¡æ¯ï¼ˆå½“ç„¶ï¼Œoffset=0æ—¶é»˜è®¤å‘é€æˆåŠŸï¼‰ï¼Œè€Œåœ¨acks=1æˆ–allçš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§è€…æ˜¯å¯ä»¥æ‹¿åˆ°å‘é€æˆåŠŸåçš„offsetç­‰æ•°æ®ï¼Œå‡å¦‚å‘é€å¤±è´¥ä¹Ÿå¯ä»¥æ‹¿åˆ°æ‹¿åˆ°å¼‚å¸¸åŸå› ï¼Œä½†æ˜¯å‘é€å¼‚å¸¸åæ˜¯å¦é‡å‘æˆ–å…¶ä»–é€»è¾‘ï¼Œå…¶å®æ˜¯ç”Ÿäº§è€…çš„ä»£ç è‡ªå®šä¹‰çš„ï¼Œkafkaå¯¹æ­¤å¹¶æ— è¦æ±‚ï¼Ÿ&lt;/p></description></item></channel></rss>